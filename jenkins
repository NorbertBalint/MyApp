pipeline {
    agent any
    stages {
        stage('Docker build') {
            steps {
                echo "Build docker on ${WORKSPACE}..."
                script { docker.build("android:latest") }
            }
        }

        stage('Build') {
            agent { docker {
                        image 'android'
                        args "-v android-gradle-cache:/workspace/.gradle -e GRADLE_USER_HOME=/workspace/.gradle"
                        reuseNode true } }
            steps {
                sh 'chmod +x ./gradlew'
                sh './gradlew clean assembleDebug'
            }
        }
    }
}